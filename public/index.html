<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Premium Operator App</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        /* আপনার দেওয়া মূল CSS এখানে থাকবে */
        :root { --primary-blue: #5865f2; --accent-orange: #ff8c7a; --bg-color: #f8faff; --white: #ffffff; --text-main: #2d3436; --text-muted: #636e72; --robi: #d71921; --gp: #007bc3; --bl: #f48220; --airtel: #ed1c24; --teletalk: #78b833; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body, html { width: 100%; height: 100%; background-color: var(--bg-color); overflow: hidden; }
        .main-wrapper { width: 100%; height: 100vh; display: flex; flex-direction: column; }
        
        /* Login Screen Style */
        #login-screen { position: fixed; inset: 0; background: var(--bg-color); z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .login-box { background: white; width: 100%; max-width: 350px; padding: 30px; border-radius: 30px; box-shadow: 0 15px 35px rgba(0,0,0,0.05); text-align: center; }
        .login-box h2 { margin-bottom: 20px; font-size: 22px; }
        .login-btn { width: 100%; padding: 12px; margin-top: 15px; border: none; border-radius: 12px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-google { background: white; border: 1px solid #ddd; color: #333; }
        .btn-manual { background: var(--primary-blue); color: white; }
        .hidden { display: none !important; }

        /* আপনার আগের বাকি সব CSS এখানে... (Header, Balance, Cards, Nav) */
        .app-header { padding: 30px 20px 15px; display: flex; align-items: center; justify-content: space-between; }
        .profile-section-top { display: flex; align-items: center; gap: 12px; }
        .user-avatar-top { width: 45px; height: 45px; background: #eee; border-radius: 50%; overflow: hidden; border: 2px solid var(--white); }
        .user-avatar-top img { width: 100%; height: 100%; object-fit: cover; }
        .balance-card { background: var(--white); padding: 18px 22px; border-radius: 22px; display: flex; justify-content: space-between; align-items: center; margin: 0 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.03); }
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; height: 85px; display: flex; justify-content: space-around; align-items: center; border-radius: 35px 35px 0 0; box-shadow: 0 -5px 30px rgba(0,0,0,0.04); }
        .offers-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 22px; position: relative; overflow: hidden; }
        .op-tag { position: absolute; top: 0; right: 0; padding: 3px 8px; font-size: 8px; color: white; border-bottom-left-radius: 10px; }
    </style>
</head>
<body>

    <!-- Login Screen (Initially Visible) -->
    <div id="login-screen" class="hidden">
        <div class="login-box">
            <h2>Welcome Back</h2>
            <button class="login-btn btn-google" onclick="googleLogin()">
                <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" width="20"> Google Login
            </button>
            <div style="margin: 15px 0; color: #aaa; font-size: 12px;">OR</div>
            <input type="email" id="m-email" placeholder="Email" style="width:100%; padding:12px; border:1px solid #eee; border-radius:10px; margin-bottom:10px;">
            <input type="password" id="m-pass" placeholder="Password" style="width:100%; padding:12px; border:1px solid #eee; border-radius:10px; margin-bottom:10px;">
            <button class="login-btn btn-manual" onclick="manualLogin()">Login / Create Account</button>
        </div>
    </div>

    <!-- Main App -->
    <div id="app-content" class="main-wrapper hidden">
        <header class="app-header">
            <div class="profile-section-top">
                <div class="user-avatar-top"><img id="u-img" src="" alt=""></div>
                <div class="user-info-top">
                    <h2 id="u-id">ID: ...</h2>
                    <p id="u-name">Name</p>
                </div>
            </div>
        </header>

        <div id="content-view" style="overflow-y: auto;">
            <!-- Content will be injected here -->
        </div>

        <nav class="bottom-nav">
            <div onclick="switchView('recharge')"><i class="fas fa-bolt"></i></div>
            <div onclick="switchView('home')"><i class="fas fa-home"></i></div>
            <div onclick="switchView('offers')"><i class="fas fa-gift"></i></div>
        </nav>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
  apiKey: "AIzaSyCbYJQ9y9CJKiT5aJyrIA0pFRGy1uvZikA",
  authDomain: "telicombangla-1.firebaseapp.com",
  projectId: "telicombangla-1",
  storageBucket: "telicombangla-1.firebasestorage.app",
  messagingSenderId: "1020351520674",
  appId: "1:1020351520674:web:c84659bc5ca2f6b41edcfb"
};
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        const tg = window.Telegram.WebApp;
        const loginScreen = document.getElementById('login-screen');
        const appContent = document.getElementById('app-content');

        // --- AUTH LOGIC ---
        function checkAuth() {
            if (tg.initDataUnsafe?.user) {
                // ১. টেলিগ্রাম অটো লগইন
                const user = tg.initDataUnsafe.user;
                handleUserSync(user.id, user.first_name, user.photo_url);
            } else {
                // ২. ব্রাউজার লগইন চেক
                auth.onAuthStateChanged(user => {
                    if (user) {
                        handleUserSync(user.uid, user.displayName || 'Web User', user.photoURL);
                    } else {
                        loginScreen.classList.remove('hidden');
                    }
                });
            }
        }

        async function handleUserSync(uid, name, photo) {
            loginScreen.classList.add('hidden');
            appContent.classList.remove('hidden');
            
            const userRef = db.collection('users').doc(uid.toString());
            const doc = await userRef.get();

            if (!doc.exists) {
                await userRef.set({
                    id: uid,
                    name: name,
                    photo: photo || 'https://i.pravatar.cc/150',
                    balance: 0,
                    createdAt: new Date()
                });
            }

            // UI আপডেট
            userRef.onSnapshot(snap => {
                const data = snap.data();
                document.getElementById('u-id').innerText = data.id;
                document.getElementById('u-name').innerText = data.name;
                document.getElementById('u-img').src = data.photo;
                if(document.getElementById('live-bal')) document.getElementById('live-bal').innerText = '৳ ' + data.balance;
            });
            switchView('home');
        }

        // গুগল লগইন
        function googleLogin() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).catch(e => alert(e.message));
        }

        // ম্যানুয়াল লগইন/রেজিস্ট্রেশন
        function manualLogin() {
            const email = document.getElementById('m-email').value;
            const pass = document.getElementById('m-pass').value;
            auth.signInWithEmailAndPassword(email, pass).catch(() => {
                auth.createUserWithEmailAndPassword(email, pass).catch(e => alert(e.message));
            });
        }

        // অফার লোড এবং আপনার অরিজিনাল UI লজিক
        function switchView(v) {
            const view = document.getElementById('content-view');
            if(v === 'home') {
                view.innerHTML = `
                    <div class="balance-card">
                        <div><p style="font-size:11px; color:#666;">Balance</p><h3 id="live-bal">৳ ...</h3></div>
                        <div style="background:var(--primary-blue); color:white; padding:8px 15px; border-radius:12px; font-size:12px;">Add Money</div>
                    </div>
                    <div class="offers-grid" id="offers-list"></div>
                `;
                loadOffers();
            }
        }

        function loadOffers() {
            db.collection('offers').limit(4).onSnapshot(snap => {
                let html = '';
                snap.forEach(doc => {
                    const o = doc.data();
                    html += `
                        <div class="card">
                            <span class="op-tag" style="background:var(--${o.operator.toLowerCase()})">${o.operator}</span>
                            <div style="font-weight:700; font-size:11px;">${o.title}</div>
                            <button style="margin-top:10px; width:100%; background:linear-gradient(135deg, #ff8c7a, #ffb399); border:none; padding:8px; border-radius:10px; color:white; font-weight:bold;">৳ ${o.price}</button>
                        </div>`;
                });
                document.getElementById('offers-list').innerHTML = html;
            });
        }

        window.onload = checkAuth;
    </script>
</body>
</html>
